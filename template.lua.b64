-- choose your keys here
keysetup = %setup%;
-- if using mouse set to true
mouse = %mouse%;
-- set to true to log all button presses (useful when you don't know what number a key is)
logall = %log%;
-- change the delay between taps
tap_delay = %delay%;
tap_hold_delay = %hold_delay%;

-- do not change the code below
OutputLogMessage("Script initialized
Written by: Douile
");
if (mouse == true) then
  eventlisten = "MOUSE_BUTTON_PRESSED";
	OutputLogMessage("Configured for mouse buttons
");
else
	eventlisten = "G_PRESSED";
	OutputLogMessage("Configured for keyboard buttons
");
end
for k,v in pairs(keysetup) do
	OutputLogMessage("Button %d will toggle %s (%d presses)
",v[1],k,v[2]);
end
OutputLogMessage("
- start runtime log -
");

keyspressed = {};

function OnEvent(event, arg)
  if (event == eventlisten) then
    if (logall == true) then
      OutputLogMessage("Key %d pressed
",arg);
    end
    for k,v in pairs(keysetup) do
      if (arg == v[1] and k ~= null) then
          if (keyspressed[k] == true) then
            ReleaseKey(k);
            keyspressed[k] = false;
            OutputLogMessage("Recieved %s %d released %s
",event,v[1],k);
            OutputLCDMessage(string.format("Pressing %s",k));
          else
            for i=0,v[2] do
              PressKey(k);
              Sleep(tap_hold_delay);
              ReleaseKey(k);
              Sleep(tap_delay);
            end
            PressKey(k);
            keyspressed[k] = true;
            OutputLogMessage("Recieved %s %d pressed %s
",event,v[1],k);
            OutputLCDMessage(string.format("Releasing %s",k));
          end
        end
      end
    end
  end
end
